---
layout: post
title: "Grafana 8.0.4 + Mongodb"
comments: true
date: "2021-07-07 02:43:49.676000+00:00"
---



node v14.7.3

```bash
[root@localhost ~]# git clone https://github.com/JamesOsgood/mongodb-grafana.git
cd mongodb-grafana
npm i
npm build
npm serve
```

`docker-compose.yaml`

```yaml
version: '3'
services:
  grafana:
    image: grafana/grafana:8.0.4
    volumes:
      - ./lib-data:/var/lib/grafana
      - ./grafana.ini:/etc/grafana/grafana.ini
      - /root/mongodb-grafana/dist:/var/lib/grafana/plugins/mongodb
    ports:
      - 3000:3000
  mongo:
    image: mongo:4.4.6
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: root
```

```bash
docker-compose up -d
```

```python
import pymongo
import datetime
import random

c = pymongo.MongoClient("mongodb://root:root@10.6.0.13:27017")
col = c["test"]["test"]
start = datetime.datetime(2021,7,1)
end = datetime.datetime(2021,8,1)
hour = 0
while start < end:
    start = start + datetime.timedelta(hours=1)
    col.insert_one({
        "ds": start,
        "value": random.randint(1,100)
    })
```

![](/assets/img/lmqs-QBUB_509bfc679a9ae0be8e2a03af89b677ac.png)

![](/assets/img/lmqs-QBUB_2f0bc1a6664494331290a65f879c8b2c.png)


```javascript
db.test.aggregate([
	{"$match": {}},
	{"$project": {"name": "y", "value": "$value", "Time": "$ds", "_id": 0}}
])
```








